<html>
<script>

    class Transaction {

        constructor(category, type, value){
            if (type !== "income" && type !== "expense") {
                throw new Error("Invalid Transaction: Type should be income or expense ")
            }
            if (value <= 0) {
                throw new Error("Invalid Transaction: Value must be greater than zero ")
            }
            if (category === "") {
                throw new Error("Invalid Transaction: Category is required")
            }
            this.category = category
            this.type = type
            this.value = value
        }
    }

    class Month {

        constructor(name, initialBalance) {
            if (name === "") throw new Error("Invalid Month: Name is required")
            this.name = name;
            this.initialBalance = initialBalance;
            this.totalizadorDoMes = {saldo: 0, initialBalance, juros: 0, rendimentos: 0, receitas:0, despesas: 0, distribuicaoDeDespesas: [] }
            this.transactions = [];
        }

        addTransaction (transaction){
            this.transactions.push(transaction);
        }

        calcularJuros(valor) {
        const juros = arredondar(valor * 0.1)
        return juros
        }

        calcularRendimentos(valor) {
            const rendimentos = arredondar(valor * 0.005)
            return rendimentos
        }

        calcularSaldo() {
            this.totalizadorDoMes.saldo = this.initialBalance ;
            for(const transaction of this.transactions){
                if(transaction.type === "income"){
                    this.totalizadorDoMes.saldo += transaction.value
                    this.totalizadorDoMes.receitas += transaction.value
                } 
                if(transaction.type === "expense") {
                    this.totalizadorDoMes.saldo -= transaction.value
                    this.totalizadorDoMes.despesas += transaction.value
                }
            }
            
            this.totalizadorDoMes.distribuicaoDeDespesas = distributeExpense(this.transactions, this.totalizadorDoMes.despesas)

            const estaNegativo1 =  this.totalizadorDoMes.saldo < 0
            if (estaNegativo1) {
                this.totalizadorDoMes.juros = this.calcularJuros( this.totalizadorDoMes.saldo);
                this.totalizadorDoMes.saldo = arredondar(this.totalizadorDoMes.saldo + this.totalizadorDoMes.juros)
            } else {
                this.totalizadorDoMes.rendimentos = this.calcularRendimentos( this.totalizadorDoMes.saldo);
                this.totalizadorDoMes.saldo = arredondar(this.totalizadorDoMes.saldo + this.totalizadorDoMes.rendimentos);
            }
        }

    }    

    const january = new Month("January", 0);

    function arredondar(valor) {
        return Math.round(valor*100)/100;
    }



    function distributeExpense(transactions, total) {
        const distribuicaoDeDespesas = []
        for (const transaction of transactions) {
            if(transaction.type === "expense") {
                const percentual = arredondar((transaction.value/total)*100)
                distribuicaoDeDespesas.push({category: transaction.category, percentual: percentual})
            }        
        }
        return distribuicaoDeDespesas
    }

    
    const saldoInicial = 0;

    const janeiro = new Month("Janeiro", saldoInicial);
    janeiro.addTransaction(new Transaction("Salary", "income", 3000));
    janeiro.addTransaction(new Transaction("Rent", "expense", 1000)); 
    janeiro.addTransaction(new Transaction("Energy Bill", "expense", 200)); 
    janeiro.addTransaction(new Transaction("Water Bill", "expense", 100)); 
    janeiro.addTransaction(new Transaction("Internet", "expense", 100)); 
    janeiro.addTransaction(new Transaction("Transport", "expense", 300)); 
    janeiro.addTransaction(new Transaction("Hobby", "expense", 300)); 
    janeiro.addTransaction(new Transaction("Food", "expense", 500));
    janeiro.addTransaction(new Transaction("Condo", "expense", 300));
    janeiro.addTransaction(new Transaction("Farmacy", "expense", 100));
    janeiro.calcularSaldo();
    console.log(janeiro);

    const fevereiro = new Month("Fevereiro", janeiro.totalizadorDoMes.saldo);
    fevereiro.addTransaction(new Transaction("Salary", "income", 3000));
    fevereiro.addTransaction(new Transaction("Rent", "expense", 1200));
    fevereiro.addTransaction(new Transaction("Energy Bill", "expense", 250)); 
    fevereiro.addTransaction(new Transaction("Water Bill", "expense", 100)); 
    fevereiro.addTransaction(new Transaction("Internet", "expense", 100));
    fevereiro.addTransaction(new Transaction("Transport", "expense", 500));
    fevereiro.addTransaction(new Transaction("Food", "expense", 1000));
    fevereiro.addTransaction(new Transaction("Condo", "expense", 400));   
    fevereiro.calcularSaldo();
    console.log(fevereiro);

    const marco = new Month("March", fevereiro.totalizadorDoMes.saldo)
    marco.addTransaction(new Transaction("Salary", "income", 4000)); 
    marco.addTransaction(new Transaction("Rent", "expense", 1200)); 
    marco.addTransaction(new Transaction("Energy Bill", "expense", 200)); 
    marco.addTransaction(new Transaction("Water Bill", "expense", 100)); 
    marco.addTransaction(new Transaction("Internet", "expense", 200)); 
    marco.addTransaction(new Transaction("Transport", "expense", 500)); 
    marco.addTransaction(new Transaction("Hobby", "expense", 800)); 
    marco.addTransaction(new Transaction("Food", "expense", 1000));
    marco.addTransaction(new Transaction("Condo", "expense", 400));
    marco.calcularSaldo();
    console.log(marco);
    
    // acumuladoAno = totalizadorDoMes3
    // console.log("ano")
    // console.log(acumuladoAno.saldo)

    console.log(janeiro.totalizadorDoMes.saldo === 100.5)
    console.log(fevereiro.totalizadorDoMes.saldo === -494.45)
    console.log(marco.totalizadorDoMes.saldo === -983.89)




</script>

</html>